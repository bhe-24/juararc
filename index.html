<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Jurnal Harian Remaja (Juara) - LocalStorage</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <style>
        body {
            font-family: 'Inter', sans-serif; /* Menggunakan font Inter */
            background-color: #f0f9ff; /* Warna latar belakang biru muda lembut */
            color: #1e293b; /* Warna teks utama slate-800 */
        }
        /* Animasi sederhana untuk transisi halaman */
        .page {
            display: none; /* Semua halaman disembunyikan secara default */
            animation: fadeIn 0.5s ease-in-out;
        }
        .page.active {
            display: block; /* Halaman aktif ditampilkan */
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        /* Animasi selamat datang sederhana */
        @keyframes bubbleFloat {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-10px); }
        }
        .welcome-emoji {
            animation: bubbleFloat 3s ease-in-out infinite;
            font-size: 3rem; /* Ukuran emoji lebih besar */
        }
        .mood-emoji {
            cursor: pointer;
            transition: transform 0.2s ease-in-out;
        }
        .mood-emoji:hover {
            transform: scale(1.2);
        }
        .mood-emoji.selected {
            transform: scale(1.2);
            filter: drop-shadow(0 0 5px #facc15); /* Efek glow kuning untuk emoji terpilih */
        }
        /* Styling untuk tombol navigasi */
        nav button {
            transition: all 0.3s ease;
        }
        nav button.active-nav {
            background-color: #3b82f6; /* Warna biru lebih gelap untuk tombol aktif */
            color: white;
            font-weight: bold;
        }
        /* Custom scrollbar (opsional, untuk estetika) */
        ::-webkit-scrollbar {
            width: 8px;
        }
        ::-webkit-scrollbar-track {
            background: #f0f9ff; /* Warna track scrollbar */
        }
        ::-webkit-scrollbar-thumb {
            background: #93c5fd; /* Warna thumb scrollbar biru muda */
            border-radius: 4px;
        }
        ::-webkit-scrollbar-thumb:hover {
            background: #60a5fa; /* Warna thumb scrollbar saat hover */
        }
        /* Modal styling */
        .modal {
            display: none; /* Hidden by default */
            position: fixed; /* Stay in place */
            z-index: 100; /* Sit on top */
            left: 0;
            top: 0;
            width: 100%; /* Full width */
            height: 100%; /* Full height */
            overflow: auto; /* Enable scroll if needed */
            background-color: rgba(0,0,0,0.4); /* Black w/ opacity */
        }
        .modal-content {
            background-color: #fefefe;
            margin: 15% auto; /* 15% from the top and centered */
            padding: 20px;
            border: 1px solid #888;
            width: 80%; /* Could be more or less, depending on screen size */
            max-width: 500px;
            border-radius: 0.5rem;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }
        .close-button {
            color: #aaa;
            float: right;
            font-size: 28px;
            font-weight: bold;
        }
        .close-button:hover,
        .close-button:focus {
            color: black;
            text-decoration: none;
            cursor: pointer;
        }
    </style>
</head>
<body class="min-h-screen flex flex-col">

    <header class="bg-blue-500 text-white p-4 shadow-md sticky top-0 z-50">
        <div class="container mx-auto flex justify-between items-center">
            <h1 class="text-2xl font-bold">Jurnal Harian Remaja (Juara) ✨</h1>
            <div class="flex items-center">
                <div id="user-info" class="text-sm mr-4"></div>
                <button id="logout-button" class="hidden bg-red-500 hover:bg-red-600 text-white text-xs sm:text-sm font-semibold py-1 px-3 rounded-md shadow transition duration-300">
                    Keluar
                </button>
            </div>
        </div>
    </header>

    <nav class="bg-blue-100 p-2 shadow-sm">
        <div class="container mx-auto flex flex-wrap justify-center space-x-1 sm:space-x-2">
            <button data-page="page-welcome" class="nav-button px-2 py-1 sm:px-3 sm:py-2 rounded-md hover:bg-blue-200 text-blue-700 text-xs sm:text-sm">👋 Selamat Datang</button>
            <button data-page="page-dashboard" class="nav-button px-2 py-1 sm:px-3 sm:py-2 rounded-md hover:bg-blue-200 text-blue-700 text-xs sm:text-sm">🏠 Dashboard</button>
            <button data-page="page-write-journal" class="nav-button px-2 py-1 sm:px-3 sm:py-2 rounded-md hover:bg-blue-200 text-blue-700 text-xs sm:text-sm">✍️ Tulis Jurnal</button>
            <button data-page="page-my-journals" class="nav-button px-2 py-1 sm:px-3 sm:py-2 rounded-md hover:bg-blue-200 text-blue-700 text-xs sm:text-sm">📚 Jurnal Saya</button>
            <button data-page="page-mood-tracker" class="nav-button px-2 py-1 sm:px-3 sm:py-2 rounded-md hover:bg-blue-200 text-blue-700 text-xs sm:text-sm">📊 Pelacak Mood</button>
            <button data-page="page-relax-zone" class="nav-button px-2 py-1 sm:px-3 sm:py-2 rounded-md hover:bg-blue-200 text-blue-700 text-xs sm:text-sm">🧘 Zona Tenang</button>
            <button data-page="page-settings" class="nav-button px-2 py-1 sm:px-3 sm:py-2 rounded-md hover:bg-blue-200 text-blue-700 text-xs sm:text-sm">⚙️ Pengaturan</button>
        </div>
    </nav>

    <main class="container mx-auto p-4 flex-grow">
        <section id="page-welcome" class="page active text-center">
            <div class="bg-white p-6 sm:p-8 rounded-lg shadow-lg">
                <div class="welcome-emoji mb-4">🌟</div>
                <h2 class="text-3xl sm:text-4xl font-bold text-blue-600 mb-2">Selamat Datang di Juara!</h2>
                <p class="text-lg text-slate-700 mb-6">"Ruang Amanmu, Ekspresikan Dirimu!"</p>
                <div class="max-w-sm mx-auto">
                    <label for="name-input" class="block text-sm font-medium text-slate-700 mb-1">Masukkan Namamu:</label>
                    <input type="text" id="name-input" class="w-full p-3 border border-slate-300 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500 mb-4" placeholder="Contoh: Budi">
                    <button id="name-login-button" class="w-full bg-green-500 hover:bg-green-600 text-white font-bold py-3 px-6 rounded-lg shadow transition duration-300">
                        Masuk dengan Nama
                    </button>
                </div>
                <div id="auth-status" class="mt-4 text-sm text-slate-500"></div>
            </div>
        </section>

        <section id="page-dashboard" class="page">
            <div class="bg-white p-6 rounded-lg shadow-lg">
                <h2 class="text-2xl font-bold text-blue-600 mb-6">Dashboard Saya</h2>
                
                <div class="mb-8 p-4 bg-sky-50 rounded-lg shadow">
                    <h3 class="text-xl font-semibold text-sky-700 mb-3">Bagaimana perasaanmu hari ini?</h3>
                    <div id="mood-checkin-emojis" class="flex justify-around items-center text-3xl sm:text-4xl">
                        <span class="mood-emoji" data-mood="senang">😄</span>
                        <span class="mood-emoji" data-mood="biasa">😐</span>
                        <span class="mood-emoji" data-mood="sedih">😢</span>
                        <span class="mood-emoji" data-mood="marah">😠</span>
                        <span class="mood-emoji" data-mood="cemas">😟</span>
                        <span class="mood-emoji" data-mood="semangat">🤩</span>
                    </div>
                    <p id="mood-checkin-feedback" class="text-center mt-3 text-sky-600"></p>
                </div>

                <div class="mb-8 p-4 bg-purple-50 rounded-lg shadow">
                    <h3 class="text-xl font-semibold text-purple-700 mb-2">Kutipan Hari Ini:</h3>
                    <blockquote class="italic text-purple-600">
                        <p id="daily-quote">"Setiap hari adalah kesempatan baru untuk menjadi versi terbaik dari dirimu."</p>
                        <footer class="text-sm mt-1">- Juara App</footer>
                    </blockquote>
                </div>

                <div class="mb-8 p-4 bg-yellow-50 rounded-lg shadow">
                    <h3 class="text-xl font-semibold text-yellow-700 mb-2">Streak Jurnalmu:</h3>
                    <p class="text-2xl font-bold text-yellow-600"><span id="journal-streak">0</span> hari berturut-turut 🔥</p>
                </div>

                <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
                    <button data-page="page-write-journal" class="nav-shortcut-button bg-blue-500 hover:bg-blue-600 text-white font-semibold py-3 px-4 rounded-lg shadow transition duration-300 flex items-center justify-center">
                        <i class="fas fa-pencil-alt mr-2"></i> Tulis Jurnal Baru
                    </button>
                    <button data-page="page-my-journals" class="nav-shortcut-button bg-green-500 hover:bg-green-600 text-white font-semibold py-3 px-4 rounded-lg shadow transition duration-300 flex items-center justify-center">
                        <i class="fas fa-book-open mr-2"></i> Lihat Jurnal Saya
                    </button>
                </div>
            </div>
        </section>

        <section id="page-write-journal" class="page">
            <div class="bg-white p-6 rounded-lg shadow-lg">
                <h2 class="text-2xl font-bold text-blue-600 mb-6">Tulis Jurnal Baru 📝</h2>
                <div class="mb-4">
                    <label for="journal-date" class="block text-sm font-medium text-slate-700 mb-1">Tanggal:</label>
                    <input type="date" id="journal-date" class="w-full p-2 border border-slate-300 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500">
                </div>
                <div class="mb-4">
                    <label class="block text-sm font-medium text-slate-700 mb-1">Mood hari ini:</label>
                    <div id="journal-mood-options" class="flex flex-wrap gap-2 text-2xl">
                        <span class="mood-emoji p-1 border-2 border-transparent rounded-full" data-mood="senang">😄</span>
                        <span class="mood-emoji p-1 border-2 border-transparent rounded-full" data-mood="biasa">😐</span>
                        <span class="mood-emoji p-1 border-2 border-transparent rounded-full" data-mood="sedih">😢</span>
                        <span class="mood-emoji p-1 border-2 border-transparent rounded-full" data-mood="marah">😠</span>
                        <span class="mood-emoji p-1 border-2 border-transparent rounded-full" data-mood="cemas">😟</span>
                        <span class="mood-emoji p-1 border-2 border-transparent rounded-full" data-mood="semangat">🤩</span>
                        <span class="mood-emoji p-1 border-2 border-transparent rounded-full" data-mood="syukur">🙏</span>
                        <span class="mood-emoji p-1 border-2 border-transparent rounded-full" data-mood="kreatif">🎨</span>
                    </div>
                    <input type="hidden" id="selected-journal-mood">
                </div>
                <div class="mb-4">
                    <label for="journal-text" class="block text-sm font-medium text-slate-700 mb-1">Ceritakan harimu:</label>
                    <textarea id="journal-text" rows="10" class="w-full p-2 border border-slate-300 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500" placeholder="Apa yang kamu rasakan atau alami hari ini?"></textarea>
                </div>
                <button id="save-journal-button" class="w-full bg-green-500 hover:bg-green-600 text-white font-bold py-3 px-4 rounded-lg shadow transition duration-300">
                    Simpan Jurnal
                </button>
                <p id="save-journal-feedback" class="text-center mt-3 text-green-600"></p>
            </div>
        </section>

        <section id="page-my-journals" class="page">
            <div class="bg-white p-6 rounded-lg shadow-lg">
                <h2 class="text-2xl font-bold text-blue-600 mb-6">Jurnal Saya 📖</h2>
                <div id="journal-list" class="space-y-4">
                    <p class="text-slate-500">Belum ada jurnal yang ditulis. Mulai tulis jurnalmu sekarang!</p>
                </div>
            </div>
        </section>

        <section id="page-mood-tracker" class="page">
            <div class="bg-white p-6 rounded-lg shadow-lg">
                <h2 class="text-2xl font-bold text-blue-600 mb-6">Pelacak Suasana Hatimu 📈</h2>
                <p class="mb-4 text-slate-600">Lihat bagaimana suasana hatimu berubah dari waktu ke waktu.</p>
                <div id="mood-log-list" class="space-y-3">
                    <p class="text-slate-500">Belum ada mood yang tercatat. Lakukan check-in mood di Dashboard!</p>
                </div>
                <div class="mt-6 p-4 border border-dashed border-slate-300 rounded-md text-center text-slate-500">
                    <p>Grafik visualisasi mood akan muncul di sini di versi mendatang!</p>
                </div>
            </div>
        </section>

        <section id="page-relax-zone" class="page">
            <div class="bg-white p-6 rounded-lg shadow-lg">
                <h2 class="text-2xl font-bold text-blue-600 mb-6">Zona Tenang 🧘‍♀️</h2>
                <p class="mb-6 text-slate-600">Ambil waktu sejenak untuk rileks dan menenangkan pikiran.</p>
                
                <div class="mb-8 p-4 bg-teal-50 rounded-lg shadow">
                    <h3 class="text-xl font-semibold text-teal-700 mb-3">Latihan Pernapasan Sederhana</h3>
                    <ol class="list-decimal list-inside text-teal-600 space-y-2">
                        <li>Duduk atau berbaring dengan nyaman.</li>
                        <li>Pejamkan mata jika kamu mau.</li>
                        <li>Tarik napas perlahan melalui hidung, hitung sampai 4.</li>
                        <li>Tahan napas, hitung sampai 4.</li>
                        <li>Hembuskan napas perlahan melalui mulut, hitung sampai 6.</li>
                        <li>Ulangi beberapa kali sampai merasa lebih tenang.</li>
                    </ol>
                    <div class="mt-4 text-center">
                        <div id="breathing-animation" class="w-24 h-24 bg-sky-300 rounded-full mx-auto flex items-center justify-center text-white transition-all duration-3000 ease-in-out">
                            Tarik Napas
                        </div>
                    </div>
                </div>

                <div class="p-4 bg-indigo-50 rounded-lg shadow">
                    <h3 class="text-xl font-semibold text-indigo-700 mb-3">Afirmasi Positif</h3>
                    <ul id="affirmations-list" class="list-disc list-inside text-indigo-600 space-y-1">
                        <li>Aku berharga dan cukup.</li>
                        <li>Aku mampu menghadapi tantangan.</li>
                        <li>Aku memilih kedamaian hari ini.</li>
                        <li>Aku bersyukur atas apa yang kumiliki.</li>
                    </ul>
                </div>
            </div>
        </section>

        <section id="page-settings" class="page">
            <div class="bg-white p-6 rounded-lg shadow-lg">
                <h2 class="text-2xl font-bold text-blue-600 mb-6">Pengaturan ⚙️</h2>
                
                <div class="mb-6">
                    <h3 class="text-lg font-semibold text-slate-700 mb-2">Ekspor Jurnal</h3>
                    <button id="export-email-button" class="w-full sm:w-auto bg-cyan-500 hover:bg-cyan-600 text-white font-medium py-2 px-4 rounded-md shadow mr-2 mb-2 sm:mb-0">
                        <i class="fas fa-envelope mr-2"></i> Kirim Semua Jurnal ke Email
                    </button>
                    <button id="export-whatsapp-button" class="w-full sm:w-auto bg-green-500 hover:bg-green-600 text-white font-medium py-2 px-4 rounded-md shadow">
                        <i class="fab fa-whatsapp mr-2"></i> Bagikan Jurnal Terakhir ke WhatsApp
                    </button>
                </div>

                 <div class="mb-6">
                    <h3 class="text-lg font-semibold text-slate-700 mb-2">Hapus Data Lokal</h3>
                    <p class="text-sm text-slate-500 mb-2">Tindakan ini akan menghapus semua jurnal dan log mood untuk pengguna <strong id="delete-user-name"></strong> dari browser ini. Data tidak dapat dipulihkan.</p>
                    <button id="delete-local-data-button" class="w-full sm:w-auto bg-red-500 hover:bg-red-600 text-white font-medium py-2 px-4 rounded-md shadow">
                        <i class="fas fa-trash-alt mr-2"></i> Hapus Semua Data Saya
                    </button>
                </div>

                <div class="mb-6">
                    <h3 class="text-lg font-semibold text-slate-700 mb-2">Tema Aplikasi (Segera Hadir)</h3>
                    <p class="text-slate-500">Pilih tampilan favoritmu!</p>
                </div>

                <div>
                    <h3 class="text-lg font-semibold text-slate-700 mb-2">Bantuan & FAQ (Segera Hadir)</h3>
                    <p class="text-slate-500">Temukan jawaban atas pertanyaanmu.</p>
                </div>
            </div>
        </section>
    </main>

    <footer class="bg-blue-500 text-white text-center p-4 mt-auto">
        <p>&copy; <span id="current-year"></span> Jurnal Harian Remaja (Juara). Dibuat dengan ❤️.</p>
    </footer>

    <div id="custom-modal" class="modal">
        <div class="modal-content">
            <span class="close-button" onclick="closeModal()">&times;</span>
            <p id="modal-message"></p>
            <button onclick="closeModal()" class="mt-4 bg-blue-500 hover:bg-blue-600 text-white font-bold py-2 px-4 rounded">OK</button>
        </div>
    </div>


    <script type="module">
        // Tidak ada lagi impor atau konfigurasi Firebase

        let currentUserName = null; 
        // Tidak ada lagi journalsUnsubscribe atau moodsUnsubscribe

        // --- Fungsi Modal Kustom ---
        const modal = document.getElementById('custom-modal');
        const modalMessage = document.getElementById('modal-message');
        
        function showModal(message) {
            modalMessage.textContent = message;
            modal.style.display = "block";
        }

        window.closeModal = function() {
            modal.style.display = "none";
        }
        window.onclick = function(event) {
            if (event.target == modal) {
                modal.style.display = "none";
            }
        }

        // --- Fungsi LocalStorage ---
        function getLocalStorageKey(dataType) { // dataType bisa 'journals' atau 'moods'
            if (!currentUserName) return null;
            // Membuat kunci yang unik untuk setiap pengguna dan tipe data
            return `jurnalJuara_${currentUserName.replace(/\s+/g, '_').toLowerCase()}_${dataType}`;
        }

        function saveData(dataType, dataArray) {
            const key = getLocalStorageKey(dataType);
            if (!key) return;
            localStorage.setItem(key, JSON.stringify(dataArray));
        }

        function loadData(dataType) {
            const key = getLocalStorageKey(dataType);
            if (!key) return [];
            const data = localStorage.getItem(key);
            return data ? JSON.parse(data) : [];
        }


        // --- Logika Login dengan Nama ---
        const nameLoginButton = document.getElementById('name-login-button');
        const nameInputEl = document.getElementById('name-input');
        const authStatusEl = document.getElementById('auth-status');
        const userInfoEl = document.getElementById('user-info');
        const logoutButton = document.getElementById('logout-button');
        const deleteUserNameEl = document.getElementById('delete-user-name');


        function handleNameLogin() {
            const name = nameInputEl.value.trim();
            if (!name) {
                showModal("Nama tidak boleh kosong!");
                return;
            }
            currentUserName = name; 

            authStatusEl.textContent = `Masuk sebagai: ${currentUserName}`;
            userInfoEl.textContent = `Pengguna: ${currentUserName}`;
            if(deleteUserNameEl) deleteUserNameEl.textContent = currentUserName;
            nameInputEl.value = ''; 
            logoutButton.classList.remove('hidden');

            loadJournals();
            loadMoods();
            updateJournalStreak();
            navigateToPage('page-dashboard');
        }

        if (nameLoginButton) {
            nameLoginButton.addEventListener('click', handleNameLogin);
        }
        if (nameInputEl) {
            nameInputEl.addEventListener('keypress', function(event) {
                if (event.key === 'Enter') {
                    handleNameLogin();
                }
            });
        }


        function handleLogout() {
            currentUserName = null;
            authStatusEl.textContent = 'Anda telah keluar.';
            userInfoEl.textContent = 'Belum Masuk';
            if(deleteUserNameEl) deleteUserNameEl.textContent = "";
            logoutButton.classList.add('hidden');

            if(document.getElementById('journal-list')) document.getElementById('journal-list').innerHTML = '<p class="text-slate-500">Silakan masukkan nama untuk melihat jurnal.</p>';
            if(document.getElementById('mood-log-list')) document.getElementById('mood-log-list').innerHTML = '<p class="text-slate-500">Silakan masukkan nama untuk melihat log mood.</p>';
            if(document.getElementById('journal-streak')) document.getElementById('journal-streak').textContent = '0';
            
            navigateToPage('page-welcome');
        }

        if (logoutButton) {
            logoutButton.addEventListener('click', handleLogout);
        }


        // --- Navigasi Halaman ---
        const pages = document.querySelectorAll('.page');
        const navButtons = document.querySelectorAll('.nav-button');
        const navShortcutButtons = document.querySelectorAll('.nav-shortcut-button');

        function navigateToPage(pageId) {
            if (!currentUserName && pageId !== 'page-welcome') {
                showModal("Silakan masukkan nama Anda terlebih dahulu.");
                navigateToPage('page-welcome'); 
                return;
            }
            pages.forEach(page => {
                page.classList.toggle('active', page.id === pageId);
            });
            navButtons.forEach(button => {
                button.classList.toggle('active-nav', button.dataset.page === pageId);
            });
            if (pageId === 'page-write-journal') resetJournalForm();
            if (pageId === 'page-dashboard') resetMoodCheckin();
            if (pageId === 'page-settings' && deleteUserNameEl) { // Update nama pengguna di halaman pengaturan
                 deleteUserNameEl.textContent = currentUserName || "";
            }
        }

        navButtons.forEach(button => {
            button.addEventListener('click', () => navigateToPage(button.dataset.page));
        });
        navShortcutButtons.forEach(button => {
            button.addEventListener('click', () => navigateToPage(button.dataset.page));
        });


        // --- Logika Halaman Tulis Jurnal ---
        const journalDateEl = document.getElementById('journal-date');
        const journalTextEl = document.getElementById('journal-text');
        const saveJournalButton = document.getElementById('save-journal-button');
        const saveJournalFeedbackEl = document.getElementById('save-journal-feedback');
        const journalMoodOptionsContainer = document.getElementById('journal-mood-options');
        const selectedJournalMoodEl = document.getElementById('selected-journal-mood');

        if(journalDateEl) journalDateEl.valueAsDate = new Date();

        if(journalMoodOptionsContainer) {
            journalMoodOptionsContainer.addEventListener('click', (e) => {
                if (e.target.classList.contains('mood-emoji')) {
                    journalMoodOptionsContainer.querySelectorAll('.mood-emoji').forEach(emoji => {
                        emoji.classList.remove('selected', 'border-blue-500');
                        emoji.classList.add('border-transparent');
                    });
                    e.target.classList.add('selected', 'border-blue-500');
                    e.target.classList.remove('border-transparent');
                    selectedJournalMoodEl.value = e.target.dataset.mood;
                }
            });
        }
        
        function resetJournalForm() {
            if(journalDateEl) journalDateEl.valueAsDate = new Date();
            if(journalTextEl) journalTextEl.value = '';
            if(selectedJournalMoodEl) selectedJournalMoodEl.value = '';
            if(saveJournalFeedbackEl) saveJournalFeedbackEl.textContent = '';
            if(journalMoodOptionsContainer) {
                journalMoodOptionsContainer.querySelectorAll('.mood-emoji').forEach(emoji => {
                    emoji.classList.remove('selected', 'border-blue-500');
                    emoji.classList.add('border-transparent');
                });
            }
        }

        if(saveJournalButton) {
            saveJournalButton.addEventListener('click', () => { // Tidak perlu async lagi
                if (!currentUserName) { 
                    showModal("Anda harus masuk dengan nama terlebih dahulu untuk menyimpan jurnal.");
                    navigateToPage('page-welcome');
                    return;
                }
                const date = journalDateEl.value;
                const text = journalTextEl.value.trim();
                const mood = selectedJournalMoodEl.value;

                if (!date || !text || !mood) {
                    saveJournalFeedbackEl.textContent = "Harap isi semua kolom (tanggal, mood, dan isi jurnal).";
                    saveJournalFeedbackEl.className = 'text-center mt-3 text-red-600';
                    return;
                }

                try {
                    const newJournalEntry = {
                        id: Date.now().toString(), // ID unik sederhana
                        userName: currentUserName, 
                        date: date, 
                        mood: mood,
                        text: text,
                        createdAt: new Date().toISOString() // Timestamp klien
                    };
                    
                    const journals = loadData('journals');
                    journals.push(newJournalEntry);
                    saveData('journals', journals);
                    
                    saveJournalFeedbackEl.textContent = "Jurnal berhasil disimpan!";
                    saveJournalFeedbackEl.className = 'text-center mt-3 text-green-600';
                    setTimeout(() => {
                         if(saveJournalFeedbackEl) saveJournalFeedbackEl.textContent = '';
                         navigateToPage('page-my-journals'); 
                    }, 1500);
                    resetJournalForm();
                    loadJournals(); // Muat ulang jurnal untuk memperbarui tampilan dan streak
                } catch (error) {
                    console.error("Error saving journal to localStorage: ", error);
                    saveJournalFeedbackEl.textContent = `Gagal menyimpan jurnal: ${error.message}.`;
                    saveJournalFeedbackEl.className = 'text-center mt-3 text-red-600';
                }
            });
        }

        // --- Logika Halaman Jurnal Saya ---
        const journalListEl = document.getElementById('journal-list');

        function loadJournals() { // Tidak perlu async lagi
            if (!currentUserName || !journalListEl) { 
                 if(journalListEl) journalListEl.innerHTML = '<p class="text-slate-500">Silakan masukkan nama untuk melihat jurnal.</p>';
                updateJournalStreak([]); // Pastikan streak direset jika tidak ada pengguna
                return;
            }

            const journals = loadData('journals');
            // Urutkan berdasarkan createdAt descending (string ISO date bisa diurutkan)
            journals.sort((a, b) => new Date(b.createdAt) - new Date(a.createdAt));


            if (journals.length === 0) {
                journalListEl.innerHTML = '<p class="text-slate-500">Belum ada jurnal yang ditulis. Mulai tulis jurnalmu sekarang!</p>';
                updateJournalStreak([]);
                return;
            }
            journalListEl.innerHTML = ''; 
            journals.forEach((journal) => {
                const entryDiv = document.createElement('div');
                entryDiv.className = 'p-4 bg-sky-50 rounded-lg shadow hover:shadow-md transition-shadow';
                
                let displayDate = journal.date;
                try {
                    const dateObj = new Date(journal.date + 'T00:00:00'); 
                    if (!isNaN(dateObj)) {
                       displayDate = dateObj.toLocaleDateString('id-ID', { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' });
                    }
                } catch (e) { console.warn("Error formatting date:", e); }

                entryDiv.innerHTML = `
                    <div class="flex justify-between items-start mb-2">
                        <div>
                            <h3 class="text-lg font-semibold text-sky-700">${displayDate}</h3>
                            <p class="text-sm text-sky-600">Mood: <span class="font-medium">${journal.mood} ${getEmojiForMood(journal.mood)}</span></p>
                        </div>
                        <button data-id="${journal.id}" class="delete-journal-button text-red-500 hover:text-red-700 text-sm">
                            <i class="fas fa-trash-alt mr-1"></i> Hapus
                        </button>
                    </div>
                    <p class="text-slate-700 whitespace-pre-wrap">${journal.text}</p>
                `;
                journalListEl.appendChild(entryDiv);
            });
            attachDeleteListeners();
            updateJournalStreak(journals); 
        }
        
        function attachDeleteListeners() {
            document.querySelectorAll('.delete-journal-button').forEach(button => {
                button.addEventListener('click', (e) => { // Tidak perlu async
                    if (!currentUserName) return; 
                    const journalIdToDelete = e.currentTarget.dataset.id;
                    showModalConfirm(`Apakah Anda yakin ingin menghapus jurnal ini? Tindakan ini tidak dapat dibatalkan.`, () => { // Tidak perlu async
                        try {
                            let journals = loadData('journals');
                            journals = journals.filter(journal => journal.id !== journalIdToDelete);
                            saveData('journals', journals);
                            loadJournals(); // Muat ulang untuk refresh tampilan
                            showModal("Jurnal berhasil dihapus.");
                        } catch (error) {
                            console.error("Error deleting journal from localStorage: ", error);
                            showModal(`Gagal menghapus jurnal: ${error.message}`);
                        }
                    });
                });
            });
        }

        // --- Logika Mood Check-in Dashboard & Pelacak Mood ---
        const moodCheckinEmojisContainer = document.getElementById('mood-checkin-emojis');
        const moodCheckinFeedbackEl = document.getElementById('mood-checkin-feedback');
        const moodLogListEl = document.getElementById('mood-log-list');

        if(moodCheckinEmojisContainer) {
            moodCheckinEmojisContainer.addEventListener('click', (e) => { // Tidak perlu async
                if (e.target.tagName === 'SPAN' && e.target.dataset.mood) {
                    if (!currentUserName) { 
                        showModal("Anda harus masuk dengan nama terlebih dahulu untuk mencatat mood.");
                        navigateToPage('page-welcome');
                        return;
                    }
                    const mood = e.target.dataset.mood;
                    
                    moodCheckinEmojisContainer.querySelectorAll('.mood-emoji').forEach(emoji => emoji.classList.remove('selected'));
                    e.target.classList.add('selected');

                    try {
                        const newMoodEntry = {
                            id: Date.now().toString(), // ID unik sederhana
                            userName: currentUserName, 
                            mood: mood,
                            date: new Date().toISOString().split('T')[0], 
                            createdAt: new Date().toISOString() // Timestamp klien
                        };
                        
                        const moods = loadData('moods');
                        moods.push(newMoodEntry);
                        saveData('moods', moods);

                        moodCheckinFeedbackEl.textContent = `Mood "${mood}" ${getEmojiForMood(mood)} berhasil dicatat!`;
                        moodCheckinFeedbackEl.className = 'text-center mt-3 text-sky-600';
                        setTimeout(() => { 
                            if(moodCheckinFeedbackEl) moodCheckinFeedbackEl.textContent = '';
                        }, 2000);
                        loadMoods(); // Muat ulang mood untuk update tampilan
                    } catch (error) {
                        console.error("Error saving mood to localStorage: ", error);
                        moodCheckinFeedbackEl.textContent = `Gagal menyimpan mood: ${error.message}`;
                        moodCheckinFeedbackEl.className = 'text-center mt-3 text-red-600';
                    }
                }
            });
        }

        function resetMoodCheckin() {
            if(moodCheckinFeedbackEl) moodCheckinFeedbackEl.textContent = '';
            if(moodCheckinEmojisContainer) {
                 moodCheckinEmojisContainer.querySelectorAll('.mood-emoji').forEach(emoji => emoji.classList.remove('selected'));
            }
        }

        function loadMoods() { // Tidak perlu async
            if (!currentUserName || !moodLogListEl) { 
                if(moodLogListEl) moodLogListEl.innerHTML = '<p class="text-slate-500">Silakan masukkan nama untuk melihat log mood.</p>';
                return;
            }

            const moods = loadData('moods');
            moods.sort((a, b) => new Date(b.createdAt) - new Date(a.createdAt));


            if (moods.length === 0) {
                moodLogListEl.innerHTML = '<p class="text-slate-500">Belum ada mood yang tercatat. Lakukan check-in mood di Dashboard!</p>';
                return;
            }
            moodLogListEl.innerHTML = '';
            moods.forEach((moodEntry) => {
                const entryDiv = document.createElement('div');
                entryDiv.className = 'p-3 bg-indigo-50 rounded-md shadow-sm flex justify-between items-center';
                
                let displayDate = moodEntry.date;
                try {
                    const dateObj = new Date(moodEntry.date + 'T00:00:00');
                     if (!isNaN(dateObj)) {
                       displayDate = dateObj.toLocaleDateString('id-ID', { year: 'numeric', month: 'short', day: 'numeric' });
                    }
                } catch(e) { console.warn("Error formatting mood date:", e); }

                entryDiv.innerHTML = `
                    <span class="text-indigo-700">${displayDate}: <span class="font-semibold">${moodEntry.mood}</span></span>
                    <span class="text-2xl">${getEmojiForMood(moodEntry.mood)}</span>
                `;
                moodLogListEl.appendChild(entryDiv);
            });
        }
        
        function getEmojiForMood(mood) {
            const emojiMap = {
                senang: '😄', biasa: '😐', sedih: '😢', marah: '😠', cemas: '😟',
                semangat: '🤩', syukur: '🙏', kreatif: '🎨',
            };
            return emojiMap[mood] || '❓';
        }

        // --- Logika Streak Jurnal ---
        const journalStreakEl = document.getElementById('journal-streak');
        function updateJournalStreak(journalArray = null) { // Tidak perlu async
            if (!currentUserName || !journalStreakEl) { 
                if(journalStreakEl) journalStreakEl.textContent = '0';
                return;
            }

            const journals = journalArray ? journalArray : loadData('journals');

            if (journals.length === 0) {
                journalStreakEl.textContent = '0';
                return;
            }

            // Ekstrak tanggal unik dari jurnal, urutkan descending
            const uniqueDates = [...new Set(journals.map(j => j.date))].sort().reverse();
            
            if (uniqueDates.length === 0) {
                journalStreakEl.textContent = '0';
                return;
            }

            let streak = 0;
            const today = new Date();
            today.setHours(0,0,0,0); 

            let currentDate = new Date(today);

            for (let i = 0; i < uniqueDates.length; i++) {
                const journalDate = new Date(uniqueDates[i] + 'T00:00:00'); 
                 if (isNaN(journalDate)) continue; 

                if (journalDate.getTime() === currentDate.getTime()) {
                    streak++;
                    currentDate.setDate(currentDate.getDate() - 1); 
                } else if (journalDate.getTime() < currentDate.getTime()) {
                    if (i === 0 && journalDate.getTime() === today.getTime()) {
                       // Sudah dihitung
                    } else {
                         break; 
                    }
                }
            }
            journalStreakEl.textContent = streak.toString();
        }


        // --- Logika Zona Tenang ---
        const breathingAnimationEl = document.getElementById('breathing-animation');
        const affirmations = [
            "Aku berharga dan cukup.", "Aku mampu menghadapi tantangan.",
            "Aku memilih kedamaian hari ini.", "Aku bersyukur atas apa yang kumiliki.",
            "Setiap napas memberiku kekuatan.", "Aku tenang dan fokus."
        ];
        const affirmationsListEl = document.getElementById('affirmations-list');
        let breathingInterval;

        function cycleBreathingAnimation() {
            if (!breathingAnimationEl || !document.getElementById('page-relax-zone').classList.contains('active')) {
                 if (breathingInterval) clearInterval(breathingInterval);
                return; 
            }
            
            const phases = [
                { text: 'Tarik Napas', scale: 1.2, color: '#7dd3fc', duration: 4000 },
                { text: 'Tahan', scale: 1.2, color: '#38bdf8', duration: 4000 },
                { text: 'Hembuskan', scale: 1, color: '#0ea5e9', duration: 6000 }
            ];
            let currentPhaseIndex = 0;

            function animatePhase() {
                if (!breathingAnimationEl || !document.getElementById('page-relax-zone').classList.contains('active')) {
                    if (breathingInterval) clearInterval(breathingInterval);
                    return;
                }
                const phase = phases[currentPhaseIndex];
                breathingAnimationEl.textContent = phase.text;
                breathingAnimationEl.style.transform = `scale(${phase.scale})`;
                breathingAnimationEl.style.backgroundColor = phase.color;

                currentPhaseIndex = (currentPhaseIndex + 1) % phases.length;
                if (breathingInterval) clearInterval(breathingInterval);
                breathingInterval = setTimeout(animatePhase, phase.duration);
            }
            animatePhase();
        }
        
        const relaxZoneObserver = new IntersectionObserver((entries) => {
            entries.forEach(entry => {
                if (entry.isIntersecting && entry.target.id === 'page-relax-zone') {
                    cycleBreathingAnimation();
                    loadRandomAffirmations();
                } else {
                    if (breathingInterval) clearInterval(breathingInterval);
                     if (breathingAnimationEl) {
                        breathingAnimationEl.textContent = 'Tarik Napas';
                        breathingAnimationEl.style.transform = 'scale(1)';
                        breathingAnimationEl.style.backgroundColor = '#7dd3fc';
                    }
                }
            });
        });
        const pageRelaxZone = document.getElementById('page-relax-zone');
        if(pageRelaxZone) relaxZoneObserver.observe(pageRelaxZone);

        function loadRandomAffirmations() {
            if (!affirmationsListEl) return;
            affirmationsListEl.innerHTML = '';
            const shuffled = affirmations.sort(() => 0.5 - Math.random());
            let selected = shuffled.slice(0, 4); 
            selected.forEach(text => {
                const li = document.createElement('li');
                li.textContent = text;
                affirmationsListEl.appendChild(li);
            });
        }

        // --- Logika Halaman Pengaturan (Ekspor & Hapus Data) ---
        const exportEmailButton = document.getElementById('export-email-button');
        const exportWhatsappButton = document.getElementById('export-whatsapp-button');
        const deleteLocalDataButton = document.getElementById('delete-local-data-button');


        if(exportEmailButton) {
            exportEmailButton.addEventListener('click', () => { // Tidak perlu async
                if (!currentUserName) { 
                    showModal("Anda harus masuk dengan nama untuk mengekspor jurnal.");
                    navigateToPage('page-welcome');
                    return;
                }
                try {
                    const journals = loadData('journals');
                    
                    if (journals.length === 0) {
                        showModal("Anda belum memiliki jurnal untuk diekspor.");
                        return;
                    }

                    let emailBody = `Jurnal Harian Remaja (Juara) - ${currentUserName}:\n\n`;
                    journals.sort((a, b) => new Date(a.date) - new Date(b.date)); // Urutkan berdasarkan tanggal
                    journals.forEach(journal => {
                        emailBody += `Tanggal: ${journal.date}\nMood: ${journal.mood}\n\n${journal.text}\n\n---\n\n`;
                    });

                    const mailtoLink = `mailto:?subject=${encodeURIComponent("Ekspor Jurnal Juara - " + currentUserName)}&body=${encodeURIComponent(emailBody)}`;
                    window.open(mailtoLink, '_blank');
                } catch (error) {
                    console.error("Error exporting to email: ", error);
                    showModal(`Gagal mengekspor ke email: ${error.message}`);
                }
            });
        }

        if(exportWhatsappButton) {
            exportWhatsappButton.addEventListener('click', () => { // Tidak perlu async
                 if (!currentUserName) { 
                    showModal("Anda harus masuk dengan nama untuk membagikan jurnal.");
                    navigateToPage('page-welcome');
                    return;
                }
                try {
                    const journals = loadData('journals');
                    journals.sort((a, b) => new Date(b.createdAt) - new Date(a.createdAt)); // Ambil yang terbaru
                    
                    if (journals.length === 0) {
                        showModal("Anda belum memiliki jurnal untuk dibagikan.");
                        return;
                    }

                    const lastJournal = journals[0]; 
                    let whatsappMessage = `Jurnalku (${currentUserName}) hari ini (${lastJournal.date}):\nMood: ${lastJournal.mood} ${getEmojiForMood(lastJournal.mood)}\n\n${lastJournal.text}`;
                    
                    const whatsappLink = `https://wa.me/?text=${encodeURIComponent(whatsappMessage)}`;
                    window.open(whatsappLink, '_blank');

                } catch (error) {
                    console.error("Error sharing to WhatsApp: ", error);
                    showModal(`Gagal membagikan ke WhatsApp: ${error.message}`);
                }
            });
        }

        if(deleteLocalDataButton) {
            deleteLocalDataButton.addEventListener('click', () => {
                if (!currentUserName) {
                    showModal("Tidak ada pengguna yang aktif untuk menghapus data.");
                    return;
                }
                showModalConfirm(`Apakah Anda yakin ingin menghapus SEMUA jurnal dan log mood untuk pengguna "${currentUserName}" dari browser ini? Tindakan ini tidak dapat dibatalkan.`, () => {
                    try {
                        localStorage.removeItem(getLocalStorageKey('journals'));
                        localStorage.removeItem(getLocalStorageKey('moods'));
                        showModal(`Semua data untuk pengguna "${currentUserName}" telah dihapus dari browser ini.`);
                        // Muat ulang data (yang sekarang kosong) dan update UI
                        loadJournals();
                        loadMoods();
                        updateJournalStreak();
                    } catch (error) {
                        console.error("Error deleting local data: ", error);
                        showModal(`Gagal menghapus data: ${error.message}`);
                    }
                });
            });
        }
        
        // --- Modal Konfirmasi Kustom ---
        function showModalConfirm(message, onConfirm) {
            const existingModal = document.getElementById('custom-confirm-modal');
            if (existingModal) existingModal.remove();

            const confirmModal = document.createElement('div');
            confirmModal.id = 'custom-confirm-modal';
            confirmModal.className = 'modal'; 
            confirmModal.style.display = 'block';

            const modalContent = document.createElement('div');
            modalContent.className = 'modal-content'; 

            modalContent.innerHTML = `
                <p class="mb-4">${message}</p>
                <div class="flex justify-end space-x-2">
                    <button id="confirm-cancel-btn" class="bg-slate-300 hover:bg-slate-400 text-slate-800 font-bold py-2 px-4 rounded">Batal</button>
                    <button id="confirm-ok-btn" class="bg-red-500 hover:bg-red-600 text-white font-bold py-2 px-4 rounded">Ya, Hapus</button>
                </div>
            `;

            confirmModal.appendChild(modalContent);
            document.body.appendChild(confirmModal);

            document.getElementById('confirm-ok-btn').onclick = () => {
                onConfirm();
                confirmModal.remove();
            };
            document.getElementById('confirm-cancel-btn').onclick = () => {
                confirmModal.remove();
            };
            confirmModal.onclick = function(event) {
                if (event.target == confirmModal) {
                    confirmModal.remove();
                }
            }
        }

        // --- Inisialisasi Aplikasi ---
        const currentYearEl = document.getElementById('current-year');
        if(currentYearEl) currentYearEl.textContent = new Date().getFullYear();
        
        navigateToPage('page-welcome');
        if(authStatusEl) authStatusEl.textContent = 'Silakan masukkan nama Anda untuk memulai.';


        const quotes = [
            "Setiap hari adalah kesempatan baru untuk menjadi versi terbaik dari dirimu.",
            "Kebahagiaan bukanlah sesuatu yang sudah jadi. Itu berasal dari tindakanmu sendiri.",
            "Percayalah pada dirimu sendiri, bahkan ketika tidak ada orang lain yang melakukannya.",
            "Jangan takut untuk gagal. Takutlah untuk tidak mencoba.",
            "Hal-hal kecil membuat perbedaan besar."
        ];
        const dailyQuoteEl = document.getElementById('daily-quote');
        if(dailyQuoteEl) dailyQuoteEl.textContent = `"${quotes[Math.floor(Math.random() * quotes.length)]}"`;

    </script>
</body>
</html>
